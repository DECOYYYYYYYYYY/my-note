# Linux

权限： 一位文件类型+三位二进制（拥有用户）+三位二进制（组）+三位二进制（其他用户）

## 介绍

### 目录与文件

Linux的目录为树型结构，根目录为 `/`，层级关系用`/`表示



HOME目录：当用户登录时，将HOME目录作为当前工作目录

- 普通用户的HOME目录：`/home/用户名`
- root用户的HOME目录：`/root`



隐藏文件/目录：任何以`.`开头文件或目录都会自动隐藏



Linux路径：

- 绝对路径：以根目录为起点描述路径，`/usr/local/hello.txt`
- 相对路径：以当前目录为起点描述路径，如：当前在usr目录，`local/hello.txt`
- 特殊路径符：`.`（代表当前目录）、`..`（代表上级目录）、`~`（代表HOME目录）
- 文件/目录名通配符：用于模糊匹配，`*` 表示匹配此处的任意内容（包括空）
  - `test*`：任何以test开头的内容
  - `*test`：任何以test结尾的内容
  - `*test*`：任何包含test的内容



### 用户与权限

root用户：超级管理员，拥有最高权限

普通用户：通常在HOME目录内权限不受限，在其余目录通常只有读取和执行权限



用户组：用于为一批用户统一管理权限



权限信息：如 `drwxr-xr-x` ，由一位文件类型+三位所属用户权限+三位所属用户组权限+三位其他用户权限组成

- 文件类型：`-`（文件）、`d`（目录）、`l`（软连接）
- 三位权限：三位分别表示 读 / 写 / 执行 权限，某位若为 `-` ，表示无对应权限
  - `r或-`：读权限，允许查看文件/目录内容
  - `w或-`：写权限，允许修改文件、允许创建/删除/重命名目录等
  - `x或-`：执行权限，允许执行文件、允许更改工作目录至该目录（即cd命令）



### 环境变量

> 在系统运行过程中，辅助系统运行的变量。环境变量是一种键值对结构。环境变量有HOME、USER、PWD等

PATH变量：保存了系统执行命令的搜索路径，路径之间以 `:` 隔开，执行命令时，会按顺序在这些路径中搜索命令程序。



`$环境变量名` / `${环境变量名}`：取环境变量的值，返回



临时设置环境变量：`export 变量名=变量值`



永久设置环境变量：在下列文件中添加export命令

- 针对用户，设置：`~/.bashrc`文件
- 针对全局，设置：`/etc/profile`



应用环境变量配置文件的修改：`source 配置文件路径`，使修改立即生效（一般情况需重新连接主机才能生效）

## 操作符

`|`：管道符，将符号左边的结果，作为符号右边的输入

- 例：只查找路径带有/usr/lib64的结果：`find / -name “test” | grep “/usr/lib64”`
- 支持嵌套使用：`cat a.txt | grep itheima | grep itcast`



`` `命令` ``：反引号，用反引号包裹的内容，会被作为命令执行，返回结果



`>` / `>>`：重定向符，将符号左侧的结果 覆盖/追加 写入到右侧的文件



## 命令

> 命令本质是二进制可执行程序，通过which 命令可查找其程序文件的路径
>
> 命令的格式：`command [-options1] [parameter]`
>
> - 选项的组合：如`-a -l` 可以合并为 `-al` 或 `-la`
> - 所有命令都支持 `--help` 选项，用于说明该命令的使用方式

### 基本

`which 命令`：查找命令的程序文件的路径

`man 命令`：查看命令的详细手册

`history`：显示历史输入过的命令

`clear`：清空终端内容

`top`：查看系统资源占用（CPU、内存等），内存计量单位为KB

- 选项：
  - `-p 进程名`：只显示某个进程
  - `-d 秒数`：刷新事件，默认为5
  - `-c`：显示进程的完整命令，默认为进程名
  - `-n 整数`：指定刷新次数，到达次数后退出
  - `-b`：以非交互式非全屏模式运行，以批次的方式执行top，一般配合-n将信息重定向到文件，`top -b -n 3 > xxx`
  - `-i`：不显示闲置与僵死进程
  - `-u 用户`：查找指定用户启动的进程
- 信息：
  - CPU行：`us`（用户CPU使用率）、`sy`（系统CPU使用率）、`ni`（高优先级进程占用CPU事件百分比）、`id`（空闲CPU率）、`wa`（IO等待CPU占用率）、`hi`（CPU硬件中断率）、`si`（CPU软件中断率）、`st`（强制等待CPU占用率）
  - 内存行：`Kib Mem`（物理内存）、`Kib Swap`（虚拟内存，即交换空间）
  - 进程表头：`PR`（进程优先级，越小越高）、`NI`（等于PR-20）、`VIRT`（使用的虚拟内存）、`RES`（使用的物理内存）、`SHR`（使用的共享内存）、`S`（进程状态，S休眠、R运行、Z僵死、N负数优先级、I空闲）、`TIME+`（使用CPU时间总计，单位10毫秒）
- 交互按键：在非-b模式下有效
  - `h`：显示帮助画面
  - `c`：相当于切换`-c`参数
  - `f`：选择要展示的项目
  - `M`：根据驻留内存大小（RES）排序
  - `P`：根据CPU使用百分比排序
  - `T`：根据时间/累计时间排序
  - `E`：切换顶部内存行显示单位
  - `e`：切换进程内存显示单位
  - `l`：切换显示平均负载和启动时间信息
  - `i`：相当于切换`-i`
  - `t`：切换显示CPU状态信息
  - `m`：切换显示内存信息





### 目录与文件

`ls [-l -h -a] [路径]`：列出目录下的内容（list）

- 不提供参数：表示查看当前工作目录
- `-l`：以列表形式查看
  - 每行的信息按顺序为：权限信息、？、所属用户、所属用户组、文件大小、创建时间、文件/目录名
- `-h`：需与 `-l` 同时使用，以更加人性化的方式显示文件大小
- `-a`：显示隐藏文件



`pwd`：获取当前工作目录（Print Work Directory）



`cd [目标目录]`：切换工作目录（Change Directory）

- 不提供参数：切换HOME目录



`mkdir [-p] 新目录的路径`：创建目录（Make Directory）

- `-p`：表示创建前置路径（若父目录不存在，则创建）



`touch 新文件的路径`：创建文件



`cp [-r] 源路径 副本路径`：复制文件/目录（copy）

- `-r`：复制目录



`mv 源路径 目标路径`：移动并重命名文件/目录（move）

- 第二个参数（目标路径）：
  - 是一个已存在目录时：将源文件/目录移动到目标路径所指目录下
  - 其余情况：移动并重命名源文件/目录至目录路径



`rm [-r -f] 多个路径`：删除文件/目录（remove），支持通配符

- `-r`：删除文件夹
- `-f`：强制删除，不会给出确认提示，一般root用户会用到



`find 起始搜索路径 [选项]`：查找文件

- 选项：用于限定结果
  - `-name "文件名"`：限定文件名，支持通配符
  - `-size +|-整数[kMG]`：限定文件大小
    - `+` / `-`：表示 大于/小于 指定尺寸
    - `k` / `M` / `G`：表示 KB / MB / GB



`ln -s 源文件或目录路径 链接路径`：创建软链接



`tar [选项] [多个被压缩文件路径]`：压缩/解压tar格式文件

- 选项：

  - `-c`：创建压缩包
  - `-v`：显示进度
  - `-f 压缩包路径`：必须选项，指定要创建/解压的压缩包路径，必须在所有选项后面（除了-C）
  - `-z`：gzip模式，即创建/解压.tar.gz文件
  - `-x`：启用解压模式
  - `-C 路径`：在所有操作前，更改目录至指定路径

- 示例：

  - 压缩文件：

    ```shell
    tar -cvf test.tar 1.txt 2.txt
    tar -zcvf test.tar.gz *.txt
    ```

  - 解压文件：

    ```
    tar -xvf test.tar #解压到当前目录
    tar -svf test.tar -C /home/xxx #解压到指定目录
    tar -zxvf test.tar.gz #解压.tar.gz文件
    ```



`zip [-r] 压缩包路径 多个文件/目录`：压缩文件至zip文件（需安装zip）

- `-r`：若被压缩参数中包含目录，需开启该选项



`unzip [-d 解压目录]`：解压zip文件（需安装unzip）

- `-d`：指定解压目录，同tar命令的-C选项，默认解压至当前目录



### 文件内容

`cat 文件路径`：查看文件内容

`more 文件路径`：查看文件内容

- 相比cat支持翻页查看：空格翻页，q退出查看



`grep [-n] "关键字" 文件路径或管道符内容输入`：从文件中通过关键字过滤文件行

- `-n`：在结果中显示匹配的行的行号



`wc [-c -m -l -w] 文件路径或管道符内容输入`：统计文件

- `-c`：统计bytes数量
- `-m`：统计字符数量
- `-l`：统计行数
- `-w`：统计单词数量



`echo "内容"`：在命令行输出内容



`tail [-f] 文件路径`：查看文件尾部内容

- `-f`：持续跟踪文件修改
- `-整数`：查看尾部指定行数，默认值为10



`vi/vim [选项] 文件路径`：使用 vi / vim 编辑文件，vim 是 vi 的加强版本

- 若文件不存在，则创建
- 选项：
  - `+行数`：打开文件时，将光标停在指定行数，默认停在首行
  - `+/关键字`：打开文件时，高亮显示关键字



### 用户与权限

> 下面涉及变更用户、变更用户组、权限修改的命令都需要root权限

`su [-] [用户名]`：切换用户（Switch User）

- `-`：切换用户后加载环境变量，建议带上
- 用户名默认为root



`exit`：退出当前用户，或使用快捷键：ctrl+d



`sudo 命令`：使用root授权执行该命令

- 为普通用户配置sudo认证：root用户执行`visudo`或编辑`/etc/sudoers`，在文件的最后添加：`用户名	ALL=(ALL)	NOPASSWD: ALL`，注意，用制表符分隔




`groupadd 用户组名`：创建用户组



`groupdel 用户组名`：删除用户组



`useradd [选项] 用户名`：创建用户

- `-g 用户组`：用户加入指定用户组。若不指定-g，自动创建用户名同名的用户组并加入
- `-d 路径`：指定HOME目录路径，默认为`/home/用户名`



`userdel [-r] 用户名`：删除用户

- `-r`：同时删除用户的HOME目录



`id [用户名]`：查看用户所属组，不指定用户则查看自身



`usermod -aG 用户组 用户名`：将指定用户加入用户组



`getent passwd`：列举系统中的用户

- 用`:`分隔显示7份信息：分别为用户名、密码、用户ID、组ID、描述信息、HOME目录、执行终端



`getent group`：列举系统中的用户组

- 用`:`分隔显示3份信息：分别为组名、组认证、组ID



`chmod [-R] 权限信息 路径`：修改文件/目录权限，需要所属用户、所属用户组或root权限

- `-R`：同时修改目录下全部内容的权限
- 权限信息：`u=rwx,g=rx,o=x`，u / g / o 分别表示 所属用户 / 所属用户组 / 其他用户 权限
  - 也可用数字表示权限信息：rwx视为三位二进制，r/w/x表示1，-表示0。如上例可写为`751`



`chown [-R] [用户][:用户组] 路径`：修改 文件/目录 的所属用户和用户组

- `-R`：同时修改目录下全部内容的权限



### 软件、服务与进程

`yum [install | remove | search] [-y] 软件名称 `：CentOS安装/卸载/搜索软件

- `-y`：自动确认
- Ubuntu使用apt命令管理软件，用法同yum
- yum和apt命令都需要root权限，并联网



`systemctl start|stop|restart|disable|enable|status 服务名`：管理服务

- `start`：启动
- `stop`：停止
- `status`：查看状态
- `disable`：关闭开机自启
- `enable`：开启开机自启
- `restart`：重启



`ps [-e -f]`：查看进程信息（process）

- `-e`：显示全部进程
- `-f`：展示全部信息
  - 每行的信息有：UID（所属用户ID）、PID（进程ID）、PPID（父进程ID）、C（CPU占用率）、STIME（启动时间）、TTY（启动进程的终端序号）、TIME（进程占用CUP的事件）、CMD（进程的名称/启动路径/启动命令）



`kill [-9] 进程PID`：关闭进程

- `-9`：强制关闭进程

### 时间

`date [-d "时间偏移"] ["+格式化字符串"]`：查看系统时间

- `-d`：显示偏移后的时间，例`-d "+1 day"`、`-d "-1 month"`
  - 支持的时间标记：year、month、day、hour、minute、second
- 格式化字符串：如`"+%Y-%m-%d %H:%M:%S"`
  - `%Y`：年
  - `%y`：两位年份 (00..99)
  - `%m`：月份 (01..12)
  - `%d`：日 (01..31)
  - `%H`：小时 (00..23)
  - `%M`：分钟 (00..59)
  - `%S`：秒 (00..60)
  - `%s`：秒数时间戳



修改时区：

```shell
rm -f /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```



### 网络

`ifconfig`：查看本机IP地址

`hostname [set-hostname 新主机名]`：查看/修改主机名



`ping [-c 次数] ip或域名`：测试与指定服务器的网络连接状态

- `-c 次数`：检查次数，若不指定将持续检查



`curl [-O] url`：发送http请求

- `-O`：当url时下载链接时，保存文件



`nmap ip地址`：查看端口占用情况

- 可能需要安装 `nmap`



`netstat -anp | grep 端口号`：查看指定端口的占用情况

- 若系统较旧，需安装 `net-tools`



`sar -n DEV [刷新间隔秒数 [查看次数]]`：查看网络的相关统计（需安装sysstat）

- 若不传查看次数，默认为无限次数；若不传刷新间隔，默认不刷新
- 信息解释：`IFACE`（本地网卡接口的名称）、`rx/tx`（接受/发送）、`pck`数据包数、`cmp`（压缩数据包数）、`mcst`（多播数据包数）

## vim编辑器

> Linux的内置文本编辑器

vim的模式：

- 命令模式：可以进行删除、复制、粘贴等快捷操作
- 编辑模式：可以编辑文件内容
- 末行模式：可以通过命令操作文件，比如搜索、保存、退出等



### 命令模式

> 打开文件后，默认进入命令模式

光标移动：

- 单字符移动：使用方向键或 hjkl键（分别为左下上右）移动
- 移动到行首：0 或 Ctrl+6 或 home键
- 移动到行尾：$ 或 Ctrl+4 或 end键
- 向上翻页：Ctrl + b 或 pg dn键
- 向下翻页：Ctrl + f 或 pg up键
- 移动到文件的第一行 / 第n行 / 最后一行：`gg` / `nG` / `G`



替换与搜索：

- 向下搜索：`/字符串` 并回车
  - 继续向下搜索：`n`
- 向上搜索：`?字符串` 并回车
  - 继续向上搜索：`N`
- 替换字符串：
  - `:%s/word1/word2/g`：word1替换为word2
  - `:%s/word1/word2/gc`：替换，且替换前由用户确认
  - `:1,10s/word1/word2/g`：替换第1行到第10行



复制粘贴与删除：

- 撤回/重做：u / Ctrl + r
- 重复上一次操作：.
- 剪切一行/多行：dd / 行数dd
- 复制一行/多行：yy / 行数yy
- 粘贴到上/下一行：P / p
- 删除前/后一个字符：X / x
- 删除光标前/后所有内容：dgg / dG
- 删除至本行的开头/结尾：d$ / d0



重复操作：`数字加指令`

- 向下移动10行：`10↓` 或 `10j`
- 粘贴2次：`2p`
- ...



### 编辑模式

> 在命令模式按下 i 或 o 或 R 进入编辑模式，编辑模式下按 esc 返回命令模式

- `i`：进入输入模式，进入后显示 – INSTER–
- `o`：进入输入模式，在光标下一行插入新行，进入后显示 – INSTER –
- `R`：进入取代模式，输入的值会取代光标所在的内容，进入后显示 – REPLACE –



### 末行模式

> 在命令模式下按 : 进入末行模式，末行模式下按 esc 返回命令模式

指令：

- 保存：`:w`
- 退出：`:q`
- 保存后退出：`:wq`
- 不保存，强制退出：`:q!`
- 显示行号：`:set nu`
- 取消显示行号：`:set nonu`
- 另存为：`:w 文件路径`
- 将第2到5行的内容另存为：`:2,5 w 文件路径`
- 输入另一个文件的内容到光标的下一行：`:r [文件路径]`



## 快捷操作

`ctrl + c`：强制停止程序运行或命令输入

`ctrl + d`：退出用户（同exit）或某些程序的专属页面（如python）

`!不完整命令`：根据不完整命令，匹配历史命令，并执行

`ctrl + r`：根据输入，匹配历史命令，回车后执行。使用左右方向键则得到命令（不执行）

`ctrl + a/e`：光标跳至命令开头/结尾

`ctrl + 左右方向键`：光标向前/后跳一个单词

`ctrl + l`：清空终端内容（clear）



## 常用软件

### ntp

自动校准时间

```shell
yum install -y ntp
systemctl start ntpd
systemctl enable ntpd
ntpdate -u ntp.aliyun.com #手动校准
```



### wget

非交互式文件下载器，用于在命令行内下载网络文件

`wget [-b] url`：下载

- `-b`：后台下载，并将日志写入当前工作目录的wget-log文件



### lrzsz

使用终端软件连接主机时，进行文件传输（支持FinalShell、XShell等）

`rz`：上传文件

`sz 文件路径`：下载文件

